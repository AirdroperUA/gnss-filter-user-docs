# Діагностика підключення

Цей документ допомагає, коли GNSS не визначається, DR1 постійно активний або тюнінг через MAVLink не працює.

## 1) Шлях GNSS (STM32 <-> GNSS)

Ознаки:
- У логах постійно `GNS nav=0` і `s=0`.
- `age` росте, з’являються `GNS no NAV-PVT`.

Перевірки:
1. **Живлення**: GNSS має стабільні 5 В (або необхідну напругу) і GND.
2. **UART піни**: GNSS TX -> STM32 `A3` (RX), GNSS RX -> STM32 `A2` (TX).
3. **Швидкість**: GNSS має працювати в режимі UBX зі швидкістю `460800` бод. Якщо швидкість інша, переналаштуйте приймач.
4. **Умови прийому**: перевіряйте на відкритому небі, у приміщенні супутників може не бути.

Швидка перевірка:
- У GCS мають з’являтися `GNS nav=...` із `s>=5` і `age<1000ms`.

## 2) Шлях GPS до FC (STM32 <-> GPS UART FC)

Ознаки:
- FC показує **GPS: No GPS**, хоча GNSS стабільний у логах фільтра.

Перевірки:
1. **UART піни**: STM32 `A11/A12` підключені до GPS UART на FC (перехресно TX/RX).
2. **Протокол порту**: GPS UART на FC має бути **u-blox** і `460800`.
3. **Стан DR**: у DR1 пересилання GNSS блокується. Для тесту потрібен DR0.

Швидка перевірка:
- У DR0 на FC мають з’явитися супутники та 3D fix після стабілізації GNSS.

## 3) MAVLink шлях (STM32 <-> телеметрія FC)

Ознаки:
- `tune_cli.py` не читає параметри.
- Немає статусних повідомлень у GCS.

Перевірки:
1. **UART піни**: STM32 `A9/A10` підключені до телеметрії FC (перехресно TX/RX).
2. **Протокол**: телеметрійний порт FC налаштований на MAVLink2 `115200` бод.
3. **SYSID/COMPID**: типово `SYSID=42`, `COMPID=191`.

Швидка перевірка:
- Команда: `python tools/tune_cli.py --port COM12 --baud 115200 list`
- Має показати параметри фільтра (`BLEND_MS`, `RJ_BASE_M`, `SNR_EN` тощо).

## 4) Типові помилки

- TX/RX не перехрещені (має бути TX -> RX, RX -> TX).
- Переплутані GNSS і FC GPS UART.
- MAVLink UART підключений до GPS UART на FC.
- Немає спільної землі між STM32, GNSS і FC.

Якщо все правильно, але GNSS не з’являється, зробіть скрін логів і перевірте проводи мультиметром на цілісність.
