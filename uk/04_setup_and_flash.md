# Інструкція з налаштування

## 1) Передумови

- Плата STM32F401 з фільтром встановлена та **вже прошита** (перепрошивка користувачем не потрібна).
- Прошивка FC: **ArduPilot 4.6.1 або новіший**, вхід GPS — **UBX (u-blox)**.
- Перед встановленням фільтра **має бути робочий GPS для первинних калібрувань**:
  - відкалібрований акселерометр
  - відкалібрований компас
  - інакше **EKF flags trip** може залишатися активним і FC не повернеться в DR0
- Польотний контролер має бути налаштований з:
  - одним телеметрійним UART для MAVLink2
  - одним GPS UART для UBX

## 2) Налаштування UART на FC (ArduPilot)

Використайте два UART‑порти FC:

1. **MAVLink-порт (до STM32 `A9/A10`)**
   - `SERIALx_PROTOCOL = 2` (MAVLink2)
   - `SERIALx_BAUD = 115` (115200 бод)
2. **GPS UART (до STM32 `A11/A12`)**
   - `SERIALy_PROTOCOL = 5` (GPS)
   - `SERIALy_BAUD = 460` (460800 бод)

Тип GPS на стороні FC має бути u-blox.

Встановіть такі параметри GPS в ArduPilot:

- `GPS_AUTO_SWITCH = 0`
- `GPS1_TYPE = 2` (u-blox)
- `GPS_AUTO_CONFIG = 0`

## 3) Очікувана поведінка фільтра

- `SYSID` фільтра = `42`, `COMPID` = onboard computer (`191`).
- Фільтр блокує подачу GNSS до FC, **перекриваючи пересилання UBX на GPS UART FC**.
- Під час DR1 пересилання UBX на GPS UART FC вимкнене.

## 4) Перевірки після першого запуску

У повідомленнях GCS перевірте, що є:

- повідомлення про запуск фільтра
- ростуть лічильники GNSS NAV
- немає попередження про стару прошивку

Якщо FC пише **"No GPS config data"**:

- перевірте протокол/швидкість GPS UART на FC;
- перевірте перехресне підключення `A11/A12` (TX/RX);
- перевірте спільну землю.
