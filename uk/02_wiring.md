# Підключення (STM32F401 BlackPill)

Ця прошивка використовує **три UART-з’єднання** на STM32:

1. GNSS і STM32 (двобічний обмін, UBX-вхід для парсингу)
2. FC MAVLink і STM32 (двобічний обмін, керування/статус/тюнінг)
3. FC GPS і STM32 (двобічний обмін, «сирий» UBX для GPS-порту FC)

## Карта пінів (поточна прошивка)

| Функція | Пін STM32 | Підключити до |
|---|---|---|
| GNSS RX | `A3` | GNSS TX |
| GNSS TX | `A2` | GNSS RX |
| FC MAV RX | `A10` | FC MAV TX (телеметрійний порт) |
| FC MAV TX | `A9` | FC MAV RX (телеметрійний порт) |
| FC GPS RX | `A12` | FC GPS TX (GPS UART FC) |
| FC GPS TX | `A11` | FC GPS RX (GPS UART FC) |
| Імпульс DR1 | `B5` | За потреби: зовнішня логіка |

## Напрямок сигналів (TX -> RX)

- GNSS **TX** -> STM32 `A3` (GNSS RX у прошивці).
- GNSS **RX** <- STM32 `A2` (GNSS TX у прошивці).
- FC MAV **TX** -> STM32 `A10` (MAV RX).
- FC MAV **RX** <- STM32 `A9` (MAV TX).
- FC GPS **TX** -> STM32 `A12` (GPS RX).
- FC GPS **RX** <- STM32 `A11` (GPS TX).

## Схеми

![Схема підключення](../diagrams/GNSS-TX-A3.png)

![Приклад правильного підключення](../diagrams/wiring_ok_example.png)

## Фото плати (довідково)

Два поширені варіанти BlackPill STM32F401. Маркування пінів і функції однакові.

![BlackPill варіант A](../diagrams/blackpill_variant_a.jpeg)

![BlackPill варіант B](../diagrams/blackpill_variant_b.jpg)

Якщо GNSS або MAVLink не працює після підключення, див. `03_wiring_debug.md`.

Також підключіть:

- `GND` (STM32) до GND GNSS і GND FC (спільна земля обов’язкова).
- Живлення згідно з вашим проєктом (GNSS та FC не живляться від UART-пінів).

## Важливі примітки

- UART-лінії потрібно **перехрещувати** (`TX` до `RX`, `RX` до `TX`).
- `A11/A12` на BlackPill — це USB D-/D+; використовуючи їх як UART, ви свідомо перепризначаєте USB-функцію.
- Якщо змінюєте піни в коді, синхронізуйте з документацією та проводкою.
- Якщо GNSS TX/RX переплутані, перевірте режим `GNSS_SWAP` (0/1) без перепрошивки.

## Імпульс події DR1 (`B5`)

- Під час переходу DR0 → DR1 прошивка піднімає `B5` у high на 3 секунди, потім опускає у low.
- Полярність зафіксована у прошивці; перевірте поточну поведінку під час першого запуску.
