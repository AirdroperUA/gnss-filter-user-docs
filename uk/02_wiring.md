# Підключення (STM32F401 BlackPill)

Ця прошивка використовує **три UART-з’єднання** на STM32:

1. GNSS і STM32 (двосторонній обмін, UBX-вхід для парсингу)
2. FC MAVLink і STM32 (двосторонній обмін, керування/статус/тюнінг)
3. FC GPS і STM32 (двосторонній обмін, «сирий» UBX для GPS-порту FC)

## Карта пінів (поточна прошивка)

| Функція | Пін STM32 | Підключити до |
|---|---|---|
| GNSS RX | `A3` | GNSS TX |
| GNSS TX | `A2` | GNSS RX |
| FC MAV RX | `A10` | FC MAV TX (телеметрійний порт) |
| FC MAV TX | `A9` | FC MAV RX (телеметрійний порт) |
| FC GPS RX | `A12` | FC GPS TX (GPS UART FC) |
| FC GPS TX | `A11` | FC GPS RX (GPS UART FC) |
| Імпульс DR1 | `B5` | За потреби: зовнішня логіка |

## Напрямок сигналів (TX -> RX)

- GNSS **TX** -> STM32 `A3` (вхід RX).
- GNSS **RX** <- STM32 `A2` (вихід TX).
- FC MAV **TX** -> STM32 `A10` (вхід RX MAV).
- FC MAV **RX** <- STM32 `A9` (вихід TX MAV).
- FC GPS **TX** -> STM32 `A12` (вхід RX GPS).
- FC GPS **RX** <- STM32 `A11` (вихід TX GPS).

## Схеми

![Схема підключення](../diagrams/GNSS-TX-A3.png)

![Приклад правильного підключення](../diagrams/wiring_ok_example.png)

## Фото плати (довідково)

Два поширені варіанти BlackPill STM32F401. Маркування пінів і функції однакові.

![BlackPill варіант A](../diagrams/blackpill_variant_a.jpeg)

![BlackPill варіант B](../diagrams/blackpill_variant_b.jpg)

Якщо GNSS або MAVLink не працює після підключення, див. `03_wiring_debug.md`.

Також підключіть:

- `GND` (STM32) до GND GNSS і GND FC (спільна земля обов’язкова).
- Живлення згідно з вашим проєктом (GNSS та FC не живляться від UART-пінів).

## Важливі примітки

- UART-лінії потрібно **перехрещувати** (`TX` до `RX`, `RX` до `TX`).
- `A11/A12` на BlackPill — це USB D-/D+; використовуючи їх як UART, ви свідомо перепризначаєте USB-функцію.
- Runtime-обмін GNSS TX/RX на STM32F401 у цій прошивці не підтримується. Якщо TX/RX переплутані, виправте фізичне підключення (GNSS TX -> `A3`, GNSS RX -> `A2`).

## Імпульс події DR1 (`B5`)

- Під час переходу DR0 → DR1 прошивка переводить `B5` у високий рівень на 3 секунди, потім у низький.
- Полярність зафіксована у прошивці; перевірте поточну поведінку під час першого запуску.
