# Лабораторна валідація антиспуф-захисту (тільки оборонний підхід)

Цей документ присвячений лише оборонній перевірці стійкості до GNSS-спуфінгу.

## 1) Межі та призначення

- Мета: підтвердити, що STM32-фільтр захищає навігацію FC, коли GNSS-дані стають підозрілими.
- Дозволене застосування: тільки законні, авторизовані та ізольовані лабораторні умови.
- Не включено: інструкції, що підвищують можливість атаки (налаштування пристроїв, методи передачі, покроковий спуфінг приймача).

## 2) Відео-референс

- Відео: https://www.youtube.com/watch?v=EFvWup8oCCE
- Сприймайте відео як демонстрацію оборонного процесу валідації.
- Використовуйте його разом із чеклістом цього документа та збереженими логами.

## 3) Цілі оборонної валідації

1. Підтвердити нормальну роботу в DR0 при здоровому GNSS.
2. Підтвердити перехід у DR1 при появі спуф-подібних аномалій.
3. Підтвердити блокування пересилання GNSS під час DR1.
4. Підтвердити контрольоване повернення в DR0 лише після виконання умов rejoin.
5. Підтвердити відсутність коливань DR0/DR1 на стабільних вхідних даних.

## 4) Рекомендоване лабораторне середовище

- RF-ізольована зона тестування під контролем кваліфікованих спеціалістів.
- Жодних випромінювальних тестів поруч із реальними бортами, аеродромами або публічними операціями.
- Якщо у вашій авторизованій RF-лабораторії використовується окрема SDR-платформа, поширений набір обладнання: **HackRF One + PortaPack H2**.
- Повне логування:
  - статусні повідомлення фільтра,
  - повідомлення FC,
  - таймлайн умов тесту для кожного прогону.

Примітка: цей документ не містить інструкцій з налаштування або використання HackRF/PortaPack.

## 5) Сценарії тестів (релевантні до спуфінгу)

Використовуйте контрольовані, дозволені джерела аномалій та перевіряйте очікувану реакцію фільтра:

1. **Великий стрибок позиції**
   - Очікування: вхід у DR1, блокування пересилання GNSS.
2. **Нереалістична обчислена швидкість**
   - Очікування: вхід у DR1 і утримання захисного стану.
3. **Аномалії по висоті**
   - Очікування: вхід у DR1 при провалі висотних перевірок узгодженості.
4. **SNR-аномалії (якщо увімкнено у вашому профілі)**
   - Очікування: вхід у DR1 після відпрацювання hold-таймера.
5. **Сценарій відновлення**
   - Очікування: повернення в DR0 тільки після виконання умов якості/часу.

## 6) Що перевіряти в логах

- Зміни стану DR (`DR=0` -> `DR=1` -> `DR=0`).
- Тренд GNSS до/під час аномалій (`GNS nav`, `age`, кількість супутників).
- Наявність повідомлень про причину входу в DR1.
- Повідомлення про rejoin під час повернення в DR0.
- Відсутність небезпечних навігаційних стрибків FC під час DR1.

## 7) Типові збої валідації

- **DR1 не вмикається під час аномалії**
  - Пороги захисту занадто м'які або аномалія недостатня для поточного профілю.
- **DR1 вмикається надто часто**
  - Профіль занадто суворий, стартова нестабільність або слабка базова якість GNSS.
- **Немає стабільного повернення в DR0**
  - Не виконуються умови rejoin по якості/часу.
- **Нестабільні результати між прогонами**
  - Слабкий контроль стенду, неповні логи або різні умови тесту.

## 8) Критерії проходження перед польотами

Усі пункти мають бути виконані:

1. DR1 стабільно спрацьовує на спуф-подібних аномаліях у повторних прогонах.
2. Під час DR1 пересилання GNSS залишається заблокованим.
3. Повернення в DR0 стабільне та відтворюване.
4. Поведінка FC залишається контрольованою (без небезпечних навігаційних стрибків).
5. Логи та записи умов тесту повністю збережені для рев'ю.
